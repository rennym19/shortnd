# shortnd
An URL Shortener API built with Python and Django

### Try here:
https://shortnd-app.herokuapp.com/

## Setting up the API (Back End)
- Clone the repository, then go to the newly created project root
  ```
  git clone https://github.com/rennym19/shortnd
  cd shortnd
  ```
- Create a new virtual environment and install requirements
  ```
  virtualenv env
  source env/bin/activate
  pip install -r requirements.txt
  ```
- Install MySQLServer (you could actually install any other DBMS supported by Django but this time I will use mysql) and create an empty DB called "shortnd"
  ```
  mysql -u root -p
  > enter your mysql password
  CREATE DATABASE shortnd;
  ```
- Install Redis Server on your computer (otherwise you'd have to make some changes to the code)
- Go to the shortnd/shortnd directory (the one that has the settings.py file) and create your .env file. Type and save your DB credentials in the .env file. The file will only have one line and it should look like this: DATABASE_URL=mysql://user:password@host:port/shortnd
  ```
  touch .env
  nano .env
  > (.env) DATABASE_URL=mysql://user:password@host:port/shortnd
  ```
- Run migrations (don't forget to go back to the project's root directory)
  ```
  python manage.py migrate
  ```

## Setting up the Client (React app)
- Go to the frontend root and install npm dependencies
  ```
  cd frontend
  npm install
  ```

## Running
1. Open the terminal and cd to where your redis-server executable is, then, run it.
  ```
  ./redis-server
  ```
2. Open another terminal in shortnd's root directory and run (make sure your virtual env is activated):
  ```
  python manage.py rqworker default
  ```
3. In another terminal (also in the project's root directory and again, make sure your virtual env is activated) run:
  ```
  python manage.py runserver
  ```

## Testing
1. Activate the project's virtual env.
2. If you want to run the test cases that correspond to TDD:
  ```
  python manage.py test
  ```
2. If you want to run the features that correspond to BDD:
  ```
  python manage.py harvest
  ```

## Algorithm used for URL short codes
  The end goal in an URL Shortener is to generate an unique key for a given string (or URL). The characters used for the ID generation algorithm must be allowed for use in URLs, which means we can use all letters (lower and upper case), numbers, hyphens and underscores. However, even though hyphens and underscores are allowed in URLs, shortened URLs typically avoid their use in order to keep the URL as “good looking” as possible. That leaves us with 62 possible characters (a-z A-Z 0-9).
  
  That being said, we will be using a **base conversion algorithm**. But why run a base conversion algorithm instead of simply generating an unique number or even a hash? First, hashes are not necessarily unique, have a lot of characters (breaking the purpose of a url shortener) and looking up entries by a hash in a DB can be very very slow. The unique number? We do need that one. Why? Because if we want to generate a key that will be unique, we need to ensure that we generate that key (string) from an also unique seed number, that way, we can map a base 10 number (the seed number) to a base 62 (the number of characters accepted in urls) an ensure the keys will be unique.
  
- Our plan is to do something like the following:
  1. Get a seed number (unique, in this case we'll be using the ID generated by the DB at the time of inserting an URL in the DB).
  2. Convert the base 10 ID number to a base 62 string using our **base conversion algorithm**.
  3. Update the URL by setting its key/short_code to be equal to our newly generated key.
  4. When user clicks the shortened URL (domain + key) we get the URL that corresponds to that key an retrieve its original url. Then, redirect the user.

#### DISCLAIMER
  This is not by any means the best, most scalable way to generate a short code for an URL, for multiple reasons. However, for the sake of simplicity and because it ensures keys are unique, it's worth giving it a shot for small apps like this one.
